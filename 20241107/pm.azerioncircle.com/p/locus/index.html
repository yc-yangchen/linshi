!function(){"use strict";var e="undefined"!=typeof document?document.currentScript:null;function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}
/*!
	 * isobject <https://github.com/jonschlinkert/isobject>
	 *
	 * Copyright (c) 2014-2017, Jon Schlinkert.
	 * Released under the MIT License.
	 */var r=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)};
/*!
	 * get-value <https://github.com/jonschlinkert/get-value>
	 *
	 * Copyright (c) 2014-2018, Jon Schlinkert.
	 * Released under the MIT License.
	 */const n=r;function o(e,t,r){return"function"==typeof r.join?r.join(e):e[0]+t+e[1]}function s(e,t,r){return"function"!=typeof r.isValid||r.isValid(e,t)}function i(e){return n(e)||Array.isArray(e)||"function"==typeof e}var a=t((function(e,t,r){if(n(r)||(r={default:r}),!i(e))return void 0!==r.default?r.default:e;"number"==typeof t&&(t=String(t));const a=Array.isArray(t),c="string"==typeof t,l=r.separator||".",u=r.joinChar||("string"==typeof l?l:".");if(!c&&!a)return e;if(c&&t in e)return s(t,e,r)?e[t]:r.default;let d=a?t:function(e,t,r){if("function"==typeof r.split)return r.split(e);return e.split(t)}(t,l,r),f=d.length,h=0;do{let t=d[h];for("number"==typeof t&&(t=String(t));t&&"\\"===t.slice(-1);)t=o([t.slice(0,-1),d[++h]||""],u,r);if(t in e){if(!s(t,e,r))return r.default;e=e[t]}else{let n=!1,i=h+1;for(;i<f;)if(t=o([t,d[i++]],u,r),n=t in e){if(!s(t,e,r))return r.default;e=e[t],h=i-1;break}if(!n)return r.default}}while(++h<f&&i(e));return h===f?e:r.default})),c=r;
/*!
	 * is-primitive <https://github.com/jonschlinkert/is-primitive>
	 *
	 * Copyright (c) 2014-present, Jon Schlinkert.
	 * Released under the MIT License.
	 */function l(e){return!0===c(e)&&"[object Object]"===Object.prototype.toString.call(e)}
/*!
	 * set-value <https://github.com/jonschlinkert/set-value>
	 *
	 * Copyright (c) Jon Schlinkert (https://github.com/jonschlinkert).
	 * Released under the MIT License.
	 */
const{deleteProperty:u}=Reflect,d=function(e){return"object"==typeof e?null===e:"function"!=typeof e},f=function(e){var t,r;return!1!==l(e)&&("function"==typeof(t=e.constructor)&&(!1!==l(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf")))},h=e=>"object"==typeof e&&null!==e||"function"==typeof e,p=e=>{if(!d(e))throw new TypeError("Object keys must be strings or symbols");if((e=>"__proto__"===e||"constructor"===e||"prototype"===e)(e))throw new Error(`Cannot set unsafe key: "${e}"`)},m=(e,t,r)=>{const n=(e=>Array.isArray(e)?e.flat().map(String).join(","):e)(t?((e,t)=>{if("string"!=typeof e||!t)return e;let r=e+";";return void 0!==t.arrays&&(r+=`arrays=${t.arrays};`),void 0!==t.separator&&(r+=`separator=${t.separator};`),void 0!==t.split&&(r+=`split=${t.split};`),void 0!==t.merge&&(r+=`merge=${t.merge};`),void 0!==t.preservePaths&&(r+=`preservePaths=${t.preservePaths};`),r})(e,t):e);p(n);const o=w.cache.get(n)||r();return w.cache.set(n,o),o},y=(e,t)=>t&&"function"==typeof t.split?t.split(e):"symbol"==typeof e?[e]:Array.isArray(e)?e:m(e,t,(()=>((e,t={})=>{const r=t.separator||".",n="/"!==r&&t.preservePaths;if("string"==typeof e&&!1!==n&&/\//.test(e))return[e];const o=[];let s="";const i=e=>{let t;""!==e.trim()&&Number.isInteger(t=Number(e))?o.push(t):o.push(e)};for(let t=0;t<e.length;t++){const n=e[t];"\\"!==n?n!==r?s+=n:(i(s),s=""):s+=e[++t]}return s&&i(s),o})(e,t))),g=(e,t,r,n)=>{if(p(t),void 0===r)u(e,t);else if(n&&n.merge){const o="function"===n.merge?n.merge:Object.assign;o&&f(e[t])&&f(r)?e[t]=o(e[t],r):e[t]=r}else e[t]=r;return e},w=(e,t,r,n)=>{if(!t||!h(e))return e;const o=y(t,n);let s=e;for(let e=0;e<o.length;e++){const t=o[e],i=o[e+1];if(p(t),void 0===i){g(s,t,r,n);break}"number"!=typeof i||Array.isArray(s[t])?(h(s[t])||(s[t]={}),s=s[t]):s=s[t]=[]}return e};w.split=y,w.cache=new Map,w.clear=()=>{w.cache=new Map};var v=t(w),b=console.log;let I=class{#e;#t;constructor(e){this.#e={},this.#t=e,this.get=(e,t)=>a(this.#e,e,t),this.set=(e,t,r)=>v(this.#e,e,t,r),this.print=b}};var _="Please call it as constructor!";function x(e){if(this.constructor!==x)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(e,t)=>{const n=r.get().global;r.set("$run.result.value",n),e()}))}x.TypeId="_M41LiFx6flTIjCZgNCNnPGa",x.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var T=({key:e})=>{if(!e)throw new Error("key is required");window[e]=window[e]||{};const t=window[e];t.cmd=t.cmd||[];const r=t.cmd,n=r.push;r.push=function(e){"function"==typeof e&&e(),"function"==typeof n&&n.call(this,e)},function(){for(;r.length;){const e=r.shift();"function"==typeof e&&e()}}()};function j(e){if(this.constructor!==j)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{const s=r.get(),i={},a={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return i||n?.module}},c=T,l={key:s.name};await c(l);return t({from:this,fromType:this.constructor,fromClosure:a,toType:x})}catch(e){o(e)}}))}j.TypeId="dhxMQJ0j99uNtwSe3HaK3HJM",j.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var k=async({api:e,cmp:t})=>{};function O(e){if(this.constructor!==O)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{const s=r.get(),i={},a={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return i||n?.module}},c=k,l={api:s.global,cmp:{check:!0}};await c(l);return t({from:this,fromType:this.constructor,fromClosure:a,toType:j})}catch(e){o(e)}}))}O.TypeId="rFRKX4k0DGfrN9Mzo_lrzKwg",O.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var P=async({service:e,api:t})=>{e.register({method:"firstUserAction",handler:t.firstUserAction}),e.register({method:"adBreak",handler:t.adBreak})};function C(e){if(this.constructor!==C)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{const s=r.get(),i={},a={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return i||n?.module}},c=P,l={service:s.global.iservice,api:s.global};await c(l);return t({from:this,fromType:this.constructor,fromClosure:a,toType:O})}catch(e){o(e)}}))}C.TypeId="YA8I7oMO8E_cxeSy_iE4LV48",C.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var A=async({service:e})=>async(t,r)=>{const n=e.newId();e.register({method:n,handler:r?function({name:r,args:o},s){e.proxy({method:t.callbackId,service:this.sender,args:{name:r,args:o}}),"adBreakDone"===r&&e.unregister({method:n})}.bind(r):function({name:r,args:o}){const s=t[r];s&&(void 0!==o?s(o):s()),"adBreakDone"===r&&e.unregister({method:n})},configurable:!0}),e.proxy({method:"adBreak",args:{callbackId:n,type:t.type,name:t.name,meta:t.meta}}).catch(r?function(r){e.unregister({method:n}),e.proxy({method:t.callbackId,service:this.sender,args:{name:"adBreakDone",args:{breakType:t.type,breakStatus:"error",errorType:"service",errorMessage:`[LC] FWD ${r.message||r}`}}})}.bind(r):function(r){e.unregister({method:n});const o=t.adBreakDone;o&&o({breakType:t.type,breakStatus:"error",errorType:"service",errorMessage:`[LC] ${r.message||r}`})})};function S(e){if(this.constructor!==S)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{const s=r.get(),i={},a={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return i||n?.module}},c=A,l={service:s.global.iservice},u=await c(l);return r.set("global.adBreak",u),t({from:this,fromType:this.constructor,fromClosure:a,toType:C})}catch(e){o(e)}}))}S.TypeId="ifOxltX-IcbuKm2mWQbm6wtr",S.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var E=async({service:e})=>async t=>{e.proxy({method:"firstUserAction",args:t}).catch((e=>{console.error(`[LC] ${e.message||e}`)}))};function M(e){if(this.constructor!==M)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{const s=r.get(),i={},a={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return i||n?.module}},c=E,l={service:s.global.iservice},u=await c(l);return r.set("global.firstUserAction",u),t({from:this,fromType:this.constructor,fromClosure:a,toType:S})}catch(e){o(e)}}))}M.TypeId="UsL4680BkE8uU9l1bOkXDsHw",M.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var $=async()=>{const e={},t={};function r(){let t,r=window,n=null,o=null;for(;!t;){try{if("function"==typeof r.__tcfapi||"function"==typeof r.__cmp){"function"==typeof r.__tcfapi?(o=2,n=r.__tcfapi):(o=1,n=r.__cmp),t=r;break}}catch(e){}try{if(r.frames.__tcfapiLocator){o=2,t=r;break}}catch(e){}try{if(r.frames.__cmpLocator){o=1,t=r;break}}catch(e){}if(r===window.top)break;r=r.parent}return e.version=o,e.frame=t,e.function=n,e.version}function n(n={}){return new Promise((o=>{function s(t,r){if(r){if(!1!==t.gdprApplies)return"tcloaded"===t.eventStatus||"useractioncomplete"===t.eventStatus?(function(t){const r=t&&"boolean"==typeof t.gdprApplies?t.gdprApplies:n.defaultGdprScope;("boolean"!=typeof r||!0===r&&"string"!=typeof t.tcString)&&o({result:"cmpUnexpectedResponse",cmp:e,consentData:t})}(t),void o({result:"ok",consentData:t})):void 0;o({result:"ok",consentData:t})}else o({result:"cmpCallFailed"})}r(),e.frame?2===e.version?e.function?e.function("addEventListener",e.version,s):function(r,n,o){const s="__tcfapi";function i(e){const r=`${s}Return`,n="string"==typeof e.data&&e.data.indexOf(r)>=0?JSON.parse(e.data):e.data;if(n[r]&&n[r].callId){const e=n[r];void 0!==t[e.callId]&&t[e.callId](e.returnValue,e.success)}}window[s]=(e,r,o,i)=>{const a=Math.random()+"",c=`${s}Call`,l={[c]:{command:e,parameter:i,callId:a,version:r}};t[a]=o,n.postMessage(l,"*")},window.addEventListener("message",i,!1),window[s](r,e.version,o)}("addEventListener",e.frame,s):o({result:"cmpVersionNotV2",cmp:e}):o({result:"cmpNotFound"})}))}return{findCmp:r,findUsp:function(){let e,t,r=window;for(;!e;){try{if("function"==typeof r.__uspapi){t=r.__uspapi,e=r;break}}catch(e){}try{if(r.frames.__uspapiLocator){e=r;break}}catch(e){}if(r===window.top)break;r=r.parent}return{uspapiFrame:e,uspapiFunction:t}},lookupIabConsent:function(){return new Promise((e=>{try{n().then(e).catch((t=>e({result:"cmpLookupFailed"})))}catch(t){e({result:"cmpLookupFailed"})}}))},getGoogleAdType:function(e){if(!e||!e.vendor)return{type:"unknown"};const t=e.vendor.consents[755],r=e.vendor.legitimateInterests[755];if(!t)return{type:"not-allowed"};const{consents:n,legitimateInterests:o}=e.purpose;let s=Object.keys({1:!0,3:!0,4:!0}).every((e=>n[e])),i=[2,7,9,10].every((e=>n[e]||o[e]&&r));return s&&i?{type:"personalized"}:(n[1]||o[1])&&i?{type:"non-personalized"}:{type:"limited"}}}};function L(e){if(this.constructor!==L)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{r.get();const s={},i={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return s||n?.module}},a=$,c=await a();return r.set("global.cmp",c),t({from:this,fromType:this.constructor,fromClosure:i,toType:M})}catch(e){o(e)}}))}L.TypeId="P3-gQ1JgHgRQpgsUuzneI4Z6",L.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";let G=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t};var J=()=>({id:G()});function z(e){if(this.constructor!==z)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{r.get();const s={},i={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return s||n?.module}},a=J,c=await a();return r.set("session",c),t({from:this,fromType:this.constructor,fromClosure:i,toType:L})}catch(e){o(e)}}))}z.TypeId="UsjLX31Xj-TWej1aWj5LoySa",z.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var R={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,s||e,i),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,i=new Array(s);o<s;o++)i[o]=n[o].fn;return i},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,o,s,i){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,o),!0;case 5:return u.fn.call(u.context,t,n,o,s),!0;case 6:return u.fn.call(u.context,t,n,o,s,i),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var f,h=u.length;for(l=0;l<h;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,o);break;default:if(!c)for(f=1,c=new Array(d-1);f<d;f++)c[f-1]=arguments[f];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,o){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return i(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||o&&!a.once||n&&a.context!==n||i(this,s);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||o&&!a[c].once||n&&a[c].context!==n)&&l.push(a[c]);l.length?this._events[s]=1===l.length?l[0]:l:i(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}(R);var q=t(R.exports);function D({window:e,serviceId:t}){return e&&t?t===this.serviceId?Promise.reject(new Error("[IS] Cannot connect to self")):new Promise(((r,n)=>{const o=G();this.transactionHandler[o]=e=>{if("object"!=typeof e.data)return;const{contextId:t,scriptId:o,serviceId:s,messageId:i,sender:a}=e.data||{};t&&o&&s&&i&&a&&0!==e.ports.length&&(e.ports[0].start(),this.router=e.ports[0],this.router.onmessage=this.handleMessage.bind(this),this.router.serviceId=s,this.router.onmessageerror=e=>{console.error(`[IS] ${this.id}: Error received from router`,e?.message||e)},this.verbose&&console.log(`[IS] ${this.id}: Communication channel established with ${a}`),this.api.proxy({method:"echo",args:{ts:Date.now()}}).then((t=>{e.data.elapsed=Date.now()-e.data.ts;const n=Date.now()-t.ts;this.verbose&&console.log(`[IS] ${this.id}: Connection echo test response received from ${a} in ${n} ms`),r(e.data.body)})).catch((e=>{n(e)})))};const s=this.createMessage({transactionId:o,method:"connect"});s.body={where:{serviceId:t}},e.postMessage(s,"*"),this.setupTransactionTimeout({transactionId:o,reject:n})})):Promise.reject(new Error("[IS] Target window and service ID are required to connect to a service"))}function F(){}function V(e){return e}function X({method:e,handler:t,configurable:r=!1}){if(this.api[e])throw new Error(`[IS] Cannot register method ${e} as it is already registered.`);this.registeredHandlers[e]=t,Object.defineProperty(this.api,e,{get:()=>t,enumerable:!1,configurable:r}),this.verbose&&console.log(`[IS] ${this.id}: Registered handler for ${e}`)}function N({alias:e,method:t,service:r,configurable:n=!1}){this.api.register({method:e,handler:(e,n)=>this.api.proxy({method:t,service:r,args:e,options:n}),configurable:n}),this.verbose&&console.log(`[IS] ${this.id}: Registered proxy for ${e} to ${r}`)}const U={services:{}};function H({method:e,args:t,service:r,options:n={}}){return new Promise(((o,s)=>{const i=G();this.transactionHandler[i]=e=>{e.data.elapsed=Date.now()-e.data.ts,e.data.error?s(e.data.error):o(e.data?.body)};const a=(r||"").split("/"),c=a.shift(),l=this.clients[c];if(void 0===l){if(!this.router)return delete this.transactionHandler[i],s(new Error(`No router registered for ${this.id}`));n?.callback&&this.api.register({method:i,handler:n.callback,configurable:!0});const o=this.createMessage({transactionId:i,method:e,hasCallback:!!n?.callback});t&&(o.body=t),r&&(o.service=r),this.router.postMessage(o),this.setupTransactionTimeout({transactionId:i,reject:s,timeout:n?.timeout})}else{const r=this.createMessage({transactionId:i,method:e,hasCallback:!!n?.callback});n?.callback&&this.api.register({method:i,handler:n.callback,configurable:!0}),t&&(r.body=t),a.length>0&&(r.service=a.join("/")),l.postMessage(r),this.setupTransactionTimeout({transactionId:i,reject:s,timeout:n?.timeout})}}))}function B(){window.removeEventListener("message",this.handleMessage)}function Z({where:e,service:t}={}){if((e=e||{}).hasOwnProperty("serviceId"))if(Array.isArray(e.serviceId)){if(e.serviceId.length&&!e.serviceId.includes(t.serviceId))return!1}else if(e.serviceId!==t.serviceId)return!1;if(e.hasOwnProperty("contextId"))if(Array.isArray(e.contextId)){if(e.contextId.length&&!e.contextId.includes(t.contextId))return!1}else if(e.contextId!==t.contextId)return!1;if(e.hasOwnProperty("scriptId"))if(Array.isArray(e.scriptId)){if(e.scriptId.length&&!e.scriptId.includes(t.scriptId))return!1}else if(e.scriptId!==t.scriptId)return!1;if(e.hasOwnProperty("id"))if(Array.isArray(e.id)){if(e.id.length&&!e.id.includes(t.id))return!1}else if(e.id!==t.id)return!1;if(e.hasOwnProperty("client")){const r=Object.keys(t.clients);if(Array.isArray(e.client)){if(e.client.length&&!e.client.some((e=>r.includes(e))))return!1}else if(!r.includes(e.client))return!1}return!0}async function K({timeout:e=1e3,interval:t=100,where:r={}}={}){const n=Date.now();let o=Math.floor(e/t);const s=Y.bind(this);for(;o>0;){const e=await s({timeout:t,where:r});if(e)return this.verbose&&console.log(`[IS] ${this.id}: Router found in ${Date.now()-n}ms`),e;o--}return this.verbose&&console.log(`[IS] ${this.id}: Router not found in ${Date.now()-n}ms`),null}function Q({window:e,timeout:t,where:r}={}){return new Promise(((n,o)=>{const s=G();this.transactionHandler[s]=e=>{if("object"!=typeof e.data)return;const{contextId:t,scriptId:r,serviceId:o,messageId:s,sender:i}=e.data;t&&r&&o&&s&&i&&n(e.data)};const i=this.createMessage({transactionId:s,method:"are-you-router"});i.body={where:r},e.postMessage(i,"*"),this.setupTransactionTimeout({transactionId:s,reject:o,timeout:t})}))}function W({where:e}={}){const t=U.services,r=Object.keys(t),n=this.serviceId;for(let o=0;o<r.length;o++){const s=t[r[o]];if(s.serviceId!==n&&(Z({where:e,service:s})&&s.router_enabled))return s}return null}async function Y({timeout:e,where:t}={}){const r=W.call(this,{where:t});if(r)return{window:window,serviceId:r.serviceId,contextId:r.contextId,scriptId:r.scriptId};let n=window.parent;for(;n!==window;){const r=await Q.call(this,{window:n,timeout:e,where:t}).catch((e=>{this.verbose&&console.log(`[IS] ${this.id}: ${e.message}`)}));if(r)return{window:n,serviceId:r.serviceId,contextId:r.contextId,scriptId:r.scriptId};if(n===n.parent)break;n=n.parent}return null}function ee({method:e}){this.api[e]&&(delete this.api[e],delete this.registeredHandlers[e],this.verbose&&console.log(`[IS] ${this.id}: Unregistered handler for ${e}`))}function te(){return G()}async function re(e){const{transactionId:t,messageId:r,serviceId:n,method:o,sender:s,body:i}=e.data;if(this.serviceId===n)return;if(!Z({where:i?.where,service:this}))return;const a=new MessageChannel;a.port1.start(),this.clients[s]=a.port1,this.clients[s].onmessage=this.handleMessage.bind(this),this.clients[s].serviceId=n,this.clients[s].onmessageerror=e=>{console.error(`[IS] ${this.id}: Error received from ${s}`,e?.message||e)};const c=this.createMessage({transactionId:t,replyTo:r});c.body=i,e.source.postMessage(c,"*",[a.port2]),this.verbose&&console.log(`[IS] ${this.id}: Connection received from ${s}`);try{this.ee.emit("connected",{contextId:e.data.contextId,scriptId:e.data.scriptId,serviceId:n,service:s})}catch(e){this.verbose&&console.log(`[IS] ${this.id}: Error while emitting connected event`,e.message)}}async function ne(e){const{transactionId:t,messageId:r,serviceId:n,body:o}=e.data;if(!0!==this.router_enabled)return;if(this.serviceId===n)return;if(!Z({where:o?.where,service:this}))return;const s=this.createMessage({transactionId:t,replyTo:r});s.body=o,e.source.postMessage(s,"*")}async function oe(e){const{transactionId:t,messageId:r,method:n,service:o}=e.data,s=this.createMessage({transactionId:t,replyTo:r});try{const t=await this.api.proxy({method:n,args:e.data.body,service:o});s.body=t,e.target.postMessage(s)}catch(t){s.error=t?.message||t,e.target.postMessage(s)}}async function se(e){const{transactionId:t,messageId:r,method:n}=e.data,o=this.registeredHandlers[n],s=this.createMessage({transactionId:t,replyTo:r});try{const t=await o(e.data.body,e.data);s.body=t,e.target.postMessage(s)}catch(t){s.error=t?.message||t,e.target.postMessage(s)}}async function ie(e){const{transactionId:t}=e.data,r=this.transactionHandler[t];delete this.transactionHandler[t],await r(e)}async function ae(e){if("object"!=typeof e.data)return;const{transactionId:t,contextId:r,scriptId:n,messageId:o,serviceId:s,method:i,service:a}=e.data;if(t&&r&&n&&o&&s)switch(this.verbose&&console.log(`[IS] ${this.id}`,e.data),i){case"connect":await re.call(this,e);break;case"are-you-router":await ne.call(this,e);break;default:i&&a?await oe.call(this,e):i&&this.registeredHandlers[i]?await se.call(this,e):this.transactionHandler[t]&&await ie.call(this,e)}}function ce({transactionId:e,reject:t,timeout:r=1e3}){const n=setTimeout((()=>{clearTimeout(n),delete this.transactionHandler[e],this.api.unregister({method:e}),t(new Error("[IS] timeout"))}),r)}async function le(){const t="INTERSERVICE_CONTEXT_ID";window[t]||Object.defineProperty(window,t,{value:G(),enumerable:!1,configurable:!1}),this.contextId=window[t],this.scriptId=await async function(e){if(!e)return null;const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-1",t);return Array.from(new Uint8Array(r)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(e&&e.src||new URL("index.js",document.baseURI).href)}function ue(e){return{ts:Date.now(),contextId:this.contextId,scriptId:this.scriptId,serviceId:this.serviceId,messageId:G(),sender:this.id,...e}}async function de({id:e,verbose:t,router:r}){const n={api:{}};function o(e,t){Object.defineProperty(n.api,e,{get:()=>t,enumerable:!1,configurable:!1})}function s(e,t){const r=t.bind(n);n.api.register({method:e,handler:r})}return await async function(){if(!/^([a-z\-_]+)$/.test(e))throw new Error("[IS] Invalid ID format. ID should be lowercase and can include '-' and '_'.");this.router_enabled=r,this.serviceId=G(),this.id=e,this.verbose=t,this.ee=new q,this.router=null,this.clients={},this.transactionHandler={},this.registeredHandlers={},this.setupTransactionTimeout=ce.bind(this),this.handleMessage=ae.bind(this),this.createMessage=ue.bind(this),await le.apply(this),window.addEventListener("message",this.handleMessage),U.services[this.id]=this}.apply(n),o("connect",D.bind(n)),o("findRouter",K.bind(n)),o("register",X.bind(n)),o("unregister",ee.bind(n)),o("registerProxy",N.bind(n)),o("proxy",H.bind(n)),o("dispose",B.bind(n)),o("newId",te.bind(n)),o("on",n.ee.on.bind(n.ee)),o("once",n.ee.once.bind(n.ee)),o("off",n.ee.off.bind(n.ee)),o("addListener",n.ee.addListener.bind(n.ee)),o("removeListener",n.ee.removeListener.bind(n.ee)),o("removeAllListeners",n.ee.removeAllListeners.bind(n.ee)),s("ping",F),s("echo",V),n.api}var fe=async({query:e})=>{const t=e.is_id||"locus",r="true"===e.is_verbose,n=await de({id:t,verbose:r,router:!0}),o=await n.findRouter({where:{id:["focus","locus"]}}).catch((e=>{console.error("[LC] Failed to find router",e)}));return o&&await n.connect(o).catch((e=>{console.error("[LC] Failed to connect to router",e)})),n.on("connected",(e=>{console.log("[LC] Client connected",e)})),n};function he(e){if(this.constructor!==he)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{const s=r.get(),i={},a={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return i||n?.module}},c=fe,l={query:s.query},u=await c(l);return r.set("global.iservice",u),t({from:this,fromType:this.constructor,fromClosure:a,toType:z})}catch(e){o(e)}}))}function pe(e){if(this.constructor!==pe)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(o,s)=>{const i={caller:n,args:e,get form(){return n?.form},get module(){return n?.module}};let a=new he({engine:t,flow:r,parent:this,caller:i});for(;;){const e=await a.run();if(!e)break;if(e.toType.ParentTypeId!==this.constructor.TypeId)return o(e);a=new e.toType({engine:t,flow:r,parent:this,caller:i})}o()}))}he.TypeId="s2mjvxX7q3IKLRwk30bdD41Y",he.ParentTypeId="tqkBPLdNee7oZj_hTuImG2Th",pe.TypeId="tqkBPLdNee7oZj_hTuImG2Th",pe.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var me={exports:{}},ye={exports:{}};!function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!("string"==typeof e||e instanceof String)){var t=r(e);throw null===e?t="null":"object"===t&&(t=e.constructor.name),new TypeError("Expected a string but received a ".concat(t))}},e.exports=t.default,e.exports.default=t.default}(ye,ye.exports);var ge,we,ve=ye.exports,be={exports:{}},Ie={exports:{}};ge=Ie,we=Ie.exports,Object.defineProperty(we,"__esModule",{value:!0}),we.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;for(var r in t)void 0===e[r]&&(e[r]=t[r]);return e},ge.exports=we.default,ge.exports.default=we.default;var _e=Ie.exports;!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,r.default)(e),(t=(0,n.default)(t,s)).allow_trailing_dot&&"."===e[e.length-1]&&(e=e.substring(0,e.length-1));!0===t.allow_wildcard&&0===e.indexOf("*.")&&(e=e.substring(2));var o=e.split("."),i=o[o.length-1];if(t.require_tld){if(o.length<2)return!1;if(!t.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(i))return!1;if(/\s/.test(i))return!1}if(!t.allow_numeric_tld&&/^\d+$/.test(i))return!1;return o.every((function(e){return!(e.length>63&&!t.ignore_max_length)&&(!!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(e)&&(!/[\uff01-\uff5e]/.test(e)&&(!/^-|-$/.test(e)&&!(!t.allow_underscores&&/_/.test(e)))))}))};var r=o(ve),n=o(_e);function o(e){return e&&e.__esModule?e:{default:e}}var s={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};e.exports=t.default,e.exports.default=t.default}(be,be.exports);var xe=be.exports,Te=t(xe),je={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if((0,n.default)(t),!(r=String(r)))return e(t,4)||e(t,6);if("4"===r)return i.test(t);if("6"===r)return c.test(t);return!1};var r,n=(r=ve)&&r.__esModule?r:{default:r};var o="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",s="(".concat(o,"[.]){3}").concat(o),i=new RegExp("^".concat(s,"$")),a="(?:[0-9a-fA-F]{1,4})",c=new RegExp("^("+"(?:".concat(a,":){7}(?:").concat(a,"|:)|")+"(?:".concat(a,":){6}(?:").concat(s,"|:").concat(a,"|:)|")+"(?:".concat(a,":){5}(?::").concat(s,"|(:").concat(a,"){1,2}|:)|")+"(?:".concat(a,":){4}(?:(:").concat(a,"){0,1}:").concat(s,"|(:").concat(a,"){1,3}|:)|")+"(?:".concat(a,":){3}(?:(:").concat(a,"){0,2}:").concat(s,"|(:").concat(a,"){1,4}|:)|")+"(?:".concat(a,":){2}(?:(:").concat(a,"){0,3}:").concat(s,"|(:").concat(a,"){1,5}|:)|")+"(?:".concat(a,":){1}(?:(:").concat(a,"){0,4}:").concat(s,"|(:").concat(a,"){1,6}|:)|")+"(?::((?::".concat(a,"){0,5}:").concat(s,"|(?::").concat(a,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");e.exports=t.default,e.exports.default=t.default}(je,je.exports);var ke=je.exports;!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,r.default)(e),!e||/[\s<>]/.test(e))return!1;if(0===e.indexOf("mailto:"))return!1;if((t=(0,s.default)(t,c)).validate_length&&e.length>=2083)return!1;if(!t.allow_fragments&&e.includes("#"))return!1;if(!t.allow_query_components&&(e.includes("?")||e.includes("&")))return!1;var i,d,f,h,p,m,y,g;if(y=e.split("#"),e=y.shift(),y=e.split("?"),e=y.shift(),y=e.split("://"),y.length>1){if(i=y.shift().toLowerCase(),t.require_valid_protocol&&-1===t.protocols.indexOf(i))return!1}else{if(t.require_protocol)return!1;if("//"===e.slice(0,2)){if(!t.allow_protocol_relative_urls)return!1;y[0]=e.slice(2)}}if(e=y.join("://"),""===e)return!1;if(y=e.split("/"),e=y.shift(),""===e&&!t.require_host)return!0;if(y=e.split("@"),y.length>1){if(t.disallow_auth)return!1;if(""===y[0])return!1;if((d=y.shift()).indexOf(":")>=0&&d.split(":").length>2)return!1;var w=d.split(":"),v=(x=2,function(e){if(Array.isArray(e))return e}(_=w)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,s,i,a=[],c=!0,l=!1;try{if(s=(r=r.call(e)).next,0===t);else for(;!(c=(n=s.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(_,x)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(_,x)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),b=v[0],I=v[1];if(""===b&&""===I)return!1}var _,x;h=y.join("@"),m=null,g=null;var T=h.match(l);T?(f="",g=T[1],m=T[2]||null):(f=(y=h.split(":")).shift(),y.length&&(m=y.join(":")));if(null!==m&&m.length>0){if(p=parseInt(m,10),!/^[0-9]+$/.test(m)||p<=0||p>65535)return!1}else if(t.require_port)return!1;if(t.host_whitelist)return u(f,t.host_whitelist);if(""===f&&!t.require_host)return!0;if(!((0,o.default)(f)||(0,n.default)(f,t)||g&&(0,o.default)(g,6)))return!1;if(f=f||g,t.host_blacklist&&u(f,t.host_blacklist))return!1;return!0};var r=i(ve),n=i(xe),o=i(ke),s=i(_e);function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,allow_fragments:!0,allow_query_components:!0,validate_length:!0},l=/^\[([^\]]+)\](?::([0-9]+))?$/;function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(e===n||(o=n,"[object RegExp]"===Object.prototype.toString.call(o)&&n.test(e)))return!0}var o;return!1}e.exports=t.default,e.exports.default=t.default}(me,me.exports);var Oe=t(me.exports);function Pe(e){const t={},r=window.location.ancestorOrigins,n=window.location.href,o=window.location.origin,s=document.referrer;function i(e,r){return v(t,e,r)}function a(e){if(e&&""!==e)try{return new URL(e)}catch(e){}}function c(){const e=[n,s];for(let t=0;t<e.length;t++){const r=a(e[t]);if(!r)continue;let n=r.searchParams.get("gd_sdk_referrer_url");if(n&&(n=decodeURIComponent(n),Oe(n)))return n}}return t.referer=s,t.url=n,t.title=document.title,t.canonical=function(){const e=document.querySelector('link[rel="canonical"]');return e?e.getAttribute("href"):null}(),function(){var e=0,t=window;try{for(;t!=t.parent;)e++,t=t.parent}catch(e){i("depth.error",e.message)}i("depth.value",e)}(),function(){const e=r,n=t.depth.value;let c=o;if(i("top.domain.from","fallback"),e&&e.length>0)c=e[e.length-1],i("top.domain.from","origins");else if(0===n)c=o,i("top.domain.from","self-top");else if(1===n){const e=a(s);e&&(c=e.origin,i("top.domain.from","referrer"))}i("top.domain.value",c.replace(/^https?:\/\/(www\.)?(.*)$/i,"$2"))}(),function(){const e=c();if(e)if(Te(e,{allow_wildcard:!0}))i("partner.domain.value",e),i("partner.domain.from","partner-domain");else{const r=a(e);r?(i("partner.domain.value",r.origin.replace(/^https?:\/\/(www\.)?(.*)$/i,"$2")),i("partner.domain.from","partner-url")):(i("partner.domain.value",t.top.domain.value),i("partner.domain.from","partner-fallback"))}else i("partner.domain.value",t.top.domain.value),i("partner.domain.from","fallback")}(),function(){const e=c();0===t.depth.value?(i("partner.url.value",n),i("partner.url.from","self-top")):e?Te(e,{allow_wildcard:!0})?(i("partner.url.value",n),i("partner.url.from","partner-domain")):(i("partner.url.value",e),i("partner.url.from","partner-url")):(i("partner.url.value",s),i("partner.url.from","fallback"))}(),t}var Ce=()=>Pe();function Ae(e){if(this.constructor!==Ae)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{r.get();const s={},i={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return s||n?.module}},a=Ce,c=await a();return r.set("location",c),t({from:this,fromType:this.constructor,fromClosure:i,toType:pe})}catch(e){o(e)}}))}Ae.TypeId="PsnYe6qN5yVj0q30svuObRQM",Ae.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var Se=()=>new Promise(((e,t)=>{if("loading"===document.readyState){const t=()=>{document.removeEventListener("DOMContentLoaded",t),e()};document.addEventListener("DOMContentLoaded",t)}else"interactive"!==document.readyState&&"complete"!==document.readyState||e()}));function Ee(e){if(this.constructor!==Ee)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{r.get();const s={},i={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return s||n?.module}},a=Se;await a();return t({from:this,fromType:this.constructor,fromClosure:i,toType:Ae})}catch(e){o(e)}}))}Ee.TypeId="ipJeuhL2yNlrXMntqwBdNyZA",Ee.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var Me=async({hash:e})=>{if(!(e=e.substring(1)))return{};for(var t=e.split("&"),r={},n=0;n<t.length;n++){var o=t[n];if(o){var s=o.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):r[decodeURIComponent(s[0])]=void 0}}return r};function $e(e){if(this.constructor!==$e)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{r.get();const s={},i={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return s||n?.module}},a=Me,c={hash:window.location.hash},l=await a(c);return r.set("query",l),t({from:this,fromType:this.constructor,fromClosure:i,toType:Ee})}catch(e){o(e)}}))}$e.TypeId="3OmMR2YGQL512hv_8kH_UWRQ",$e.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";var Le=({key:e})=>{if(!e)throw new Error("key is required");window[e]=window[e]||{};return window[e]};function Ge(e){if(this.constructor!==Ge)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{try{const s=r.get(),i={},a={caller:n,resolve:t,reject:o,args:e,get form(){return n?.form},get module(){return i||n?.module}},c=Le,l={key:s.name},u=await c(l);return r.set("global",u),t({from:this,fromType:this.constructor,fromClosure:a,toType:$e})}catch(e){o(e)}}))}function Je(e){if(this.constructor!==Je)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(e,t)=>{const n=r.get(),o=window[n.name];r.set("$run.result.value",o),e()}))}function ze(e){if(this.constructor!==ze)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{r.get();const s={caller:n,args:e,get form(){return n?.form},get module(){return n?.module}};return t({from:this,fromType:this.constructor,fromClosure:s,toType:Je})}))}function Re(e){if(this.constructor!==Re)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(o,s)=>{const i=r.get(),a={caller:n,args:e,get form(){return n?.form},get module(){return n?.module}};if("function"==typeof window[i.name]?.cmp?.findCmp){const e=new ze({engine:t,flow:r,parent:this,caller:a}),n=await e.run();return n?o(n):o()}return o({from:this,fromType:this.constructor,fromClosure:a,toType:Ge})}))}function qe(e){if(this.constructor!==qe)throw Error(_);this.context=e;const{engine:t,flow:r,caller:n}=e||{};this.run=e=>new Promise((async(t,o)=>{r.get();const s={caller:n,args:e,get form(){return n?.form},get module(){return n?.module}};return r.set("name","gdlocus"),t({from:this,fromType:this.constructor,fromClosure:s,toType:Re})}))}Ge.TypeId="5I3zgqvdBeeLTZG23S9VIM8l",Ge.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15",Je.TypeId="uvdRPJ7f1wfGKUNdIwWS7FcZ",Je.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15",ze.TypeId="X-2JtBYrtNjPgzh9EQmM0ij-",ze.ParentTypeId="zAKrKbFPFHRz0eWyiGafNyTZ",Re.TypeId="zAKrKbFPFHRz0eWyiGafNyTZ",Re.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15",qe.TypeId="v9VkcqXC65sSjBXO6Az6eeZN",qe.ParentTypeId="xX4V4r92jJGAkCJOsnzGOi15";class De extends I{#r;constructor(e){super(e),this.engine=e.engine}async init(e){}waitForNext(e){this.#r=e}async continueForNext(e){const t=this.#r?.next;this.#r=void 0,t&&await t()}async run(e){await this.init(e);const t={};let r=new qe({parent:this,flow:this,engine:this.engine,caller:t});for(;;){const e=await r.run();if(!e)break;if(e.toType.ParentTypeId!==this.constructor.TypeId)throw new Error("Unknown situation");r=new e.toType({parent:this,flow:this,engine:this.engine,caller:t})}return this.get("$run")}}De.TypeId="xX4V4r92jJGAkCJOsnzGOi15";(new class extends I{#n;constructor(e){super(e),this.#n=new De({engine:this})}async#o(e){}async run(e){console.log((new Date).toLocaleString(),"locus"),await this.#o({params:e});const t=await this.#n.run({params:e});return t?.result?.value}async destroy(){}}).run().catch((e=>{console.log(e.message)}))}();
